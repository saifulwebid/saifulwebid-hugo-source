box:
    id: alpine
    cmd: /bin/sh

build:
    steps:
        - script:
            name: get Hugo binary
            code: |
                apk --no-cache add openssl ca-certificates
                wget https://github.com/gohugoio/hugo/releases/download/v0.26/hugo_0.26_Linux-64bit.tar.gz
                wget https://github.com/gohugoio/hugo/releases/download/v0.26/hugo_checksums.txt
                cat hugo_checksums.txt | sha256sum -c --ignore-missing
                tar xf hugo_0.26_Linux-64bit.tar.gz -C /usr/bin
                hugo version
        - script:
            name: build Hugo site
            code: hugo

deploy:
    steps:
        - script:
            name: get git
            code: apk --no-cache add git curl
        - takuma7/gh-pages@0.2.3:
            token: $GITHUB_TOKEN
            repo: saifulwebid/saifulwebid.github.io
            basedir: public
        - script:
            name: purge Cloudflare cache
            code: |
                curl -X DELETE "https://api.cloudflare.com/client/v4/zones/${CLOUDFLARE_ZONE}/purge_cache" -H "X-Auth-Email: ${CLOUDFLARE_AUTH_EMAIL}" -H "X-Auth-Key: ${CLOUDFLARE_AUTH_KEY}" -H "Content-Type: application/json" --data '{"purge_everything": true}'
