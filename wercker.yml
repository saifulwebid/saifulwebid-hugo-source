box:
    id: alpine
    cmd: /bin/sh

build:
    steps:
        - script:
            name: get Hugo binary
            code: |
                apk --no-cache add openssl ca-certificates
                wget https://github.com/spf13/hugo/releases/download/v0.17/hugo_0.17_Linux-64bit.tar.gz
                echo "6a74626b64434a5ee9fc5ec4fbf22ce6  hugo_0.17_Linux-64bit.tar.gz" | md5sum -c
                tar xzf hugo_0.17_Linux-64bit.tar.gz && cp ./hugo_0.17_linux_amd64/hugo_0.17_linux_amd64 /usr/bin/hugo
                hugo version
        - script:
            name: build Hugo site
            code: hugo

deploy:
    steps:
        - script:
            name: get git
            code: apk --no-cache add git curl
        - takuma7/gh-pages@0.2.3:
            token: $GITHUB_TOKEN
            repo: saifulwebid/saifulwebid.github.io
            basedir: public
        - script:
            name: purge Cloudflare cache
            code: |
                curl -X DELETE "https://api.cloudflare.com/client/v4/zones/${CLOUDFLARE_ZONE}/purge_cache" -H "X-Auth-Email: ${CLOUDFLARE_AUTH_EMAIL}" -H "X-Auth-Key: ${CLOUDFLARE_AUTH_KEY}" -H "Content-Type: application/json" --data '{"purge_everything": true}'
